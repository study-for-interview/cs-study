# π TLS/SSL handshake

# π“ TLS/SSLμ΄λ€?
μΈν„°λ„·μ€ μ•μ „ν• ν†µμ‹ μ„ μ„ν•μ—¬ μ•”νΈν™”λ¥Ό μ‚¬μ©ν•λ‹¤. μ•”νΈν™”λ€ μΌλ°μ μΈ ν‰λ¬Έμ„ μ•μ•„λ³Ό μ μ—†λ„λ΅ μ•”νΈν™” ν•μ—¬ μ•”νΈλ¬ΈμΌλ΅ λ§λ“λ” κ³Όμ •μ΄λ‹¤. μ΄μ™€ κ°™μ€ κ³Όμ •μ„ μ›Ή λΈλΌμ°μ €μ™€ μ›Ή μ„λ²„μ—λ” HTTPSλ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™”λ¥Ό ν•λ‹¤.

HTTPSλ” SSL(Secure Socket Layer)/TLS(Transport Layer Security) μ „μ†΅κΈ°μ μ„ μ‚¬μ©ν•λ‹¤. TCP,UDPμ™€ κ°™μ€ μΌλ°μ μΈ μΈν„°λ„· ν†µμ‹ μ— μ•μ „ν• κ³„μΈµμ„ μ¶”κ°€ν•λ” λ°©μ‹μ΄λ‹¤. κ·Έλ¦¬κ³  μ΄ κΈ°μ μ„ κµ¬ν„ν•κΈ° μ„ν•΄ μ›Ή μ„λ²„μ—μ„ μ„¤μΉν•λ” κ²ƒμ΄ SSL/TLS dlswmdtjdlek. TLSλ” SSLμ κ°μ„  λ²„μ „μΌλ΅, μµμ‹  μΈμ¦μ„λ” TLSλ¥Ό μ‚¬μ©ν•μ§€λ©΄ νΈμμ μΌλ΅ SSLμΈμ¦μ„λΌκ³  λ¶€λ¥Έλ‹¤.

# π“ SSL HandShake
![](https://images.velog.io/images/kcwthing1210/post/e18733ad-be27-4335-ad02-2de94029edd7/image.png)

νλ€μƒ‰ λ¶€λ¶„μ€ TCP layerμ 3-way handshakeλ΅ HTTPSκ°€ TCPκΈ°λ° ν”„λ΅ν† μ½μ΄κΈ° λ•λ¬Έμ— μ•”νΈν™” ν‘μƒ(SSL Handshake)μ— μ•μ„ μ—°κ²°μ„ μƒμ„±ν•κΈ° μ„ν•΄ μ‹¤μ‹ν•λ” κ³Όμ •μ΄κ³  μ•„λ λ…Έλ€μƒ‰ λ¶€λ¶„μ΄ SSL HandShake κ³Όμ •μ΄λ‹¤.


![](https://images.velog.io/images/kcwthing1210/post/8334e4b8-b302-43bf-9725-668d09ff51ab/image.png)

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ ‘μ† (Client Hello)
   λ‚΄κ°€ μ ‘μ†ν•λ ¤λ” μ‚¬μ΄νΈκ°€ HTTPSλ¥Ό μ‚¬μ©ν•λ©΄ λΈλΌμ°μ €λ” TCPμ—°κ²°μ„ μ„ν• 3-Way HandShakeλ¥Ό μν–‰ν• λΈλΌμ°μ €λ” λ‹¤μ μ •λ³΄λ¥Ό Client Hello λ‹¨κ³„μ— λ³΄λ‚Έλ‹¤
- λΈλΌμ°μ €κ°€ μ‚¬μ©ν•λ” SSL/TLS λ²„μ „ μ •λ³΄
- λΈλΌμ°μ €κ°€ μ§€μ›ν•λ” μ•”νΈν™” λ°©μ‹ λ¨μ(cipher suite)
    - cipher suite : λ³΄μ•μ κ¶κ·Ήμ  λ©ν‘λ¥Ό λ‹¬μ„±ν•κΈ° μ„ν•΄ μ‚¬μ©ν•λ” λ°©μ‹μ„ ν¨ν‚¤μ§€ ν•νƒλ΅ λ¬¶μ–΄λ†“μ€κ²ƒ
    - ![](https://images.velog.io/images/kcwthing1210/post/fb3a3034-c8fc-48ee-a315-99063ab07f45/image.png)
- λΈλΌμ°μ €κ°€ μκ°„μ μΌλ΅ μƒμ„±ν• μ„μμ λ‚μ
- λ§μ•½ μ΄μ „μ— SSL ν•Έλ“ μ‰μ΄ν¬κ°€ μ™„λ£λ μƒνƒλΌλ©΄, κ·Έλ• μƒμ„±λ μ„Έμ…μ•„μ΄λ””
- κΈ°νƒ€ ν™•μ¥ μ •λ³΄

2. μ„λ²„ (Server Hello) )μ„λ²„ λν• μ„μ μΈμ‚¬μ— μ‘λ‹µν•λ©°, λ‹¤μ μ •λ³΄λ¥Ό ν΄λΌμ΄μ–ΈνΈμ— μ κ³µν•λ‹¤.

- λΈλΌμ°μ €μ μ•”νΈν™” λ°©μ‹ μ •λ³΄ μ¤‘μ—μ„, μ„λ²„κ°€ μ§€μ›ν•κ³  μ„ νƒν• μ•”νΈν™” λ°©μ‹(cipher suite)
- μ„λ²„μ κ³µκ°ν‚¤κ°€ λ‹΄κΈ΄ SSL μΈμ¦μ„(μΈμ¦μ„λ” CAμ λΉ„λ°€ν‚¤λ΅ μ•”νΈν™”λμ–΄ λ°κΈ‰λ μƒνƒ)
- μ„λ²„κ°€ μκ°„μ μΌλ΅ μƒμ„±ν• μ„μμ λ‚μ
- ν΄λΌμ΄μ–ΈνΈ μΈμ¦μ„ μ”μ²­(μ„ νƒμ‚¬ν•­)

3. ν΄λΌμ΄μ–ΈνΈ) λΈλΌμ°μ €λ” μ„λ²„μ SSL μΈμ¦μ„κ°€ λ―Ώμ„λ§ν•μ§€ ν™•μΈ
   λ€λ¶€λ¶„μ λΈλΌμ°μ €μ—λ” κ³µμ‹ λ ¥ μλ” CAλ“¤μ μ •λ³΄μ™€ CAκ°€ λ§λ“  κ³µκ°ν‚¤κ°€ μ΄λ―Έ μ„¤μΉλμ–΄ μλ‹¤. μ„λ²„κ°€ λ³΄λ‚Έ SSL μΈμ¦μ„κ°€ μ •λ§ CAκ°€ λ§λ“ κ²ƒμΈμ§€ ν™•μΈν•κΈ° μ„ν•΄ λ‚΄μ¥λ CAκ³µκ°ν‚¤λ΅ μ•”νΈν™”λ μΈμ¦μ„λ¥Ό λ³µνΈν™” ν•΄λ³Έλ‹¤. μ •μƒμ μΌλ΅ λ³µνΈν™” λμ—λ‹¤λ©΄ CAκ°€ λ°κΈ‰ν• κ²ƒμ΄ μ¦λ…λλ‹¤. λ§μ•½ λ“±λ΅λ CAκ°€ μ•„λ‹κ±°λ‚, λ“±λ΅λ CAκ°€ λ§λ“  μΈμ¦μ„μ²λΌ κΎΈλ„λ‹¤λ©° μ΄ κ³Όμ •μ—μ„ λ°κ°λμ–΄ λΈλΌμ°μ € κ²½κ³ λ¥Ό λ³΄λ‚Έλ‹¤.

4. ν΄λΌμ΄μ–ΈνΈ) λΈλΌμ°μ €λ” μμ‹ μ΄ μƒμ„±ν• λ‚μμ™€ μ„λ²„μ λ‚μλ¥Ό μ΄μ©ν•μ—¬ premaster secretλ¥Ό λ§λ“ λ‹¤.
   μ›Ή μ„λ²„ μΈμ¦μ„μ— λ”Έλ ¤μ¨ μ›Ή μ‚¬μ΄νΈμ κ³µκ°ν‚¤λ΅ μ΄κ²ƒμ„ μ•”νΈν™” ν•μ—¬ μ„λ²„λ΅ μ „μ†΅ν•λ‹¤.

5. μ„λ²„) μ„λ²„λ” μ‚¬μ΄νΈμ λΉ„λ°€ν‚¤λ΅, λΈλΌμ°μ €κ°€ λ³΄λ‚Έ premaster secretκ°’μ„ λ³µνΈν™” ν•λ‹¤.
   λ³µνΈν™” ν• κ°’μ„ master secretκ°’μΌλ΅ μ €μ¥ν•λ‹¤. μ΄κ²ƒμ„ μ‚¬μ©ν•μ—¬ λ°©κΈ λΈλΌμ°μ €μ™€ λ§λ“¤μ–΄μ§„ μ—°κ²°μ— κ³ μ ν• κ°’μ„ λ¶€μ—¬ν•κΈ° μ„ν• session keyλ¥Ό μƒμ„±ν•λ‹¤. μ„Έμ… ν‚¤λ” λ€μΉ­ν‚¤ μ•”νΈν™”μ— μ‚¬μ©ν•  ν‚¤μ΄λ‹¤. μ΄κ²ƒμΌλ΅ λΈλΌμ°μ €μ™€ μ„λ²„ μ‚¬μ΄μ— μ£Όκ³ λ°›λ” λ°μ΄ν„°λ¥Ό μ•”νΈν™” ν•κ³  λ³µνΈν™” ν•λ‹¤.

6. μ„λ²„/ν΄λΌμ΄μ–ΈνΈ) SSL handshakeλ¥Ό μΆ…λ£ν•κ³  HTTPSν†µμ‹ μ„ μ‹μ‘ν•λ‹¤.
   λΈλΌμ°μ €μ™€ μ„λ²„λ” SSL handshakeκ°€ μ •μƒμ μΌλ΅ μ™„λ£ν•μ€κ³ , μ΄μ λ” μ›Ήμƒμ—μ„ λ°μ΄ν„°λ¥Ό μ„Έμ…ν‚¤λ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™”/λ³µνΈν™” ν•λ©° https ν”„λ΅ν† μ½μ„ ν†µν•΄ μ£Όκ³ λ°›μ„ μ μλ‹¤. httpsν†µμ‹ μ΄ μ™„λ£λλ” μ‹μ μ—μ„ μ„λ΅μ—κ² κ³µμ λ μ„Έμ…ν‚¤λ¥Ό νκΈ°ν•λ‹¤. λ§μ•½ μ„Έμ…μ΄ μ μ§€λκ³  μλ‹¤λ©΄ λΈλΌμ°μ €λ” SSL handshakeμ”μ²­μ΄ μ•„λ‹ μ„Έμ…IDλ§ μ„λ²„μ—κ² μ•λ ¤μ£Όλ©΄ λλ‹¤. μ΄λ¶€λ¶„μ€ 1λ²μ—μ„ μ—…κΈ‰ λμ—λ‹¤.


# Reference
- https://aws-hyoh.tistory.com/entry/HTTPS-%ED%86%B5%EC%8B%A0%EA%B3%BC%EC%A0%95-%EC%89%BD%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-3SSL-Handshake
- https://brunch.co.kr/@sangjinkang/38

# π λ΅λ“λ°Έλ°μ‹±


![](https://images.velog.io/images/kcwthing1210/post/83849c66-1c87-4376-b45f-70bc59ba0c32/image.png)

λ¶€ν•λ¶„μ‚° λλ” λ΅λ“ λ°Έλ°μ‹±μ€ μ»΄ν“¨ν„° λ„¤νΈμ›ν¬ κΈ°μ μ μΌμΆ…μΌλ΅ μ¤‘μ•™μ²λ¦¬μ¥μΉ νΉμ€ μ €μ¥μ¥μΉμ™€ κ°™μ€ μ»΄ν“¨ν„° μμ›λ“¤μ—κ² μ‘μ—…μ„ λ‚λ„λ” κ²ƒμ„ μλ―Έν•λ‹¤.

μ„λ²„μ— κ°€ν•΄μ§€λ” λ¶€ν•(=λ΅λ“)λ¥Ό λ¶„μ‚°(=λ°Έλ°μ‹±)ν•΄μ£Όλ” μ¥μΉ λλ” κΈ°μ μ΄λ‹¤.

μ‚¬μ—…μ κ·λ¨κ°€ ν™•μ¥λκ³ , ν΄λΌμ΄μ–ΈνΈμ μκ°€ λμ–΄λ‚κ² λλ©΄ κΈ°μ΅΄ μ„λ²„λ§μΌλ΅λ” μ •μƒμ μΈ μ„λΉ„μ¤κ°€ λ¶κ°€λ¥ν•κ² λλ”λ°, μ΄λ° μ¦κ°€ν• νΈλν”½μ— λ€μ²ν•  μ μλ” λ°©λ²•μ€ ν¬κ² λ‘ κ°€μ§€λ‹¤.

Scale up : μ„λ²„ μμ²΄μ μ„±λ¥μ„ λ†’μ΄λ” κ²ƒ
Scale out : μ—¬λ¬ λ€μ μ„λ²„λ¥Ό λ‘λ” κ²ƒ
Scale-outμ λ°©μ‹μ€ μ—¬λ¬ λ€μ μ„λ²„λ΅ νΈλν”½μ„ κ· λ“±ν•κ² λ¶„μ‚°ν•΄μ£Όλ” λ΅λ“λ°Έλ°μ‹±μ΄ λ°λ“μ‹ ν•„μ”ν•λ‹¤.

# π“ λ΅λ“ λ°Έλ°μ‹± μ•κ³ λ¦¬μ¦
## β” λΌμ΄λ“λ΅λΉ
μ„λ²„μ— λ“¤μ–΄μ¨ μ”μ²­μ„ μμ„λ€λ΅ λμ•„κ°€λ©° λ°°μ •ν•λ” λ°©μ‹
μ„λ²„μ™€μ μ—°κ²°μ΄ μ¤λ μ§€μ†λμ§€ μ•λ” κ²½μ° μ ν•©ν•λ‹¤.

## β” κ°€μ¤‘ λΌμ΄λ“λ΅λΉ λ°©μ‹
κ° μ„λ²„μ— κ°€μ¤‘μΉλ¥Ό λ§¤κΈ°κ³  κ°€μ¤‘μΉκ°€ λ†’μ€ μ„λ²„μ— μ”μ²­μ„ μ°μ„ μ μΌλ΅ λ°°μ •ν•λ” λ°©μ‹
μ„λ²„μ νΈλν”½ μ²λ¦¬ λ¥λ ¥μ΄ λ‹¤λ¥Έ κ²½μ° μ‚¬μ©ν•λ‹¤.

## β” μµμ† μ—°κ²° λ°©μ‹
μ”μ²­μ΄ λ“¤μ–΄μ¨ μ‹μ μ— κ°€μ¥ μ μ€ μ—°κ²° μƒνƒλ¥Ό λ³΄μ΄λ” μ„λ²„μ— νΈλν”½μ„ λ°°μ •ν•λ” λ°©μ‹.
μ„λ²„μ— λ¶„λ°°λ νΈλν”½λ“¤μ΄ μΌμ •ν•μ§€ μ•μ€ κ²½μ°μ— μ ν•©ν•λ‹¤.

## β” IP ν•΄μ‹ λ°©μ‹
ν΄λΌμ΄μ–ΈνΈμ IPμ£Όμ†λ¥Ό νΉμ • μ„λ²„λ΅ λ§¤ν•‘ν•μ—¬ μ”μ²­μ„ μ²λ¦¬ν•λ” λ°©μ‹
μ‚¬μ©μκ°€ ν•­μƒ λ™μΌν• μ„λ²„λ΅ μ—°κ²°λλ‹¤.

# π“ L4 λ΅λ“ λ°Έλ°μ‹±
νΈλμ¤ν¬νΈ κ³„μΈµμ—μ„ λ΅λ“λ¥Ό λ¶„μ‚°ν•λ‹¤.

TCP, UDP ν¬νΈ μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ ν•λ‹¤.

λ°μ΄ν„° μ•μ„ λ³΄μ§€ μ•κ³  ν¨ν‚· λ λ²¨μ—μ„λ§ λ΅λ“λ¥Ό λ¶„μ‚°ν•κΈ° λ•λ¬Έμ— μ†λ„κ°€ λΉ λ¥΄κ³  ν¨μ¨μ΄ λ†’μ

μ„¬μ„Έν• λΌμ°ν…μ΄ λ¶κ°€λ¥ν•μ§€λ§ L7λ΅λ“ λ°Έλ°μ„λ³΄λ‹¤ μ €λ ΄ν•λ‹¤.

# π“ L7 λ΅λ“ λ°Έλ°μ‹±
μ• ν”λ¦¬μΌ€μ΄μ… κ³„μΈµμ—μ„ λ΅λ“λ¥Ό λ¶„μ‚°ν•λ‹¤.

HTTP ν—¤λ”, μΏ ν‚¤ λ“±κ³Ό κ°™μ€ μ‚¬μ©μ μ”μ²­μ„ κΈ°μ¤€μΌλ΅ νΉμ • μ„λ²„μ— νΈλν”½μ„ λ¶„μ‚°ν•λ” κ²ƒμ΄ κ°€λ¥ν•λ‹¤. μ¦‰, ν¨ν‚· λ‚΄μ©μ„ ν™•μΈν•κ³  κ·Έ λ‚΄μ©μ— λ”°λΌ λ΅λ“λ¥Ό νΉμ • μ„λ²„μ— λ¶„λ°°ν•λ” κ²ƒμ΄ κ°€λ¥
νΉμ • κΈ°λ¥μ„ ν•λ” μ”μ²­μ΄ λ“¤μ–΄μ¤λ©΄ κ·Έ μ”μ²­μ„ μ²λ¦¬ν•λ” μ„λ²„λ΅ λ³΄λ‚΄λ”,,,

λ” μ„¬μ„Έν• λΌμ°ν…μ΄ κ°€λ¥ν•κ³ , λΉ„μ •μƒμ μΈ νΈλν”½μ„ ν•„ν„°λ§ ν•  μ μλ‹¤.

ν¨ν‚·μ λ‚΄μ©μ„ λ³µνΈν™” ν•΄μ•Όν•κΈ° λ•λ¬Έμ— λ” λ§μ€ λΉ„μ©μ΄ λ“ λ‹¤.