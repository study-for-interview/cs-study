# Web Server와 WAS

## 정적 페이지와 동적 페이지

![imgage](https://gmlwjd9405.github.io/images/web/static-vs-dynamic.png)

## Static Pages

웹 서버는 파일 경로 이름을 받고, 경로와 일치하는 file contents를 반환함

항상 동일한 페이지를 반환함
```
image, html, css, javascript 파일과 같이 컴퓨터에 저장된 파일들
```

## Dynamic Pages

요청의 인자에 따라 바뀌는 페이지로 내용에 맞게 동적인 contents를 반환함.

웹 서버에 의해 실행되는 프로그램을 통해 만들어진 결과물임 (Servlet : was 위에서 돌아가는 자바 프로그램)

개발자는 Servlet에 doGet() 메소드를 구현함

## 웹서버와 WAS의 차이

![image](https://gmlwjd9405.github.io/images/web/webserver-vs-was1.png)

## 웹 서버

개념에 있어서 하드웨어와 소프트웨어로 구분된다.
1. 하드웨어 : Web 서버가 설치되어 있는 컴퓨터
2. 소프트웨어 : 웹 브라우저 클라이언트로부터 HTTP 요청을 받고, 정적인 컨텐츠(html, css 등)를 제공하는 컴퓨터 프로그램

웹 서버 기능

Http 프로토콜을 기반으로, 클라이언트의 요청을 서비스하는 기능을 담당
요청에 맞게 두가지 기능 중 선택해서 제공해야 한다.

- 정적 컨텐츠 제공
    - WAS를 거치지 않고 바로 자원 제공

- 동적 컨텐츠 제공을 위한 요청 전달
    - 클라이언트 요청을 WAS에 보내고, WAS에서 처리한 결과를 클라이언트에게 전달

## WAS (servlet container)

DB 접근 및 다양한 로직 처리 요구시 동적인 컨텐츠를 제공하기 위해 만들어진 애플리케이션 서버

HTTP를 통해 애플리케이션을 수행해주는 미들웨어다.

WAS는 웹 컨테이너 혹은 자바진영에서 동적 페이지를 위한 프로그램이 서블릿이기 때문에 WAS를 서블릿 컨테이너라고도 불림
(컨테이너란 JSP, Servlet을 실행시킬 수 있는 소프트웨어. 즉, WAS는 JSP, Servlet 구동 환경을 제공해줌)

서버에 만들어진 서블릿이 스스로 작동하는 것이 아니라, 서블릿을 관리 해주는 것이 필요한데, 이러한 역할을 하는 것이 바로 서블릿 컨테이너이고 대표적으로 오픈소스인 톰캣이 있습니다.

1. 웹서버와의 통신 지원

    - 서블릿 컨테이너는 서블릿과 웹서버가 손쉽게 통신할 수 있게 해주어, 소켓을 만들고 listen, accept 등을 API로 제공하여 복잡한 과정을 생략할 수 있게 해준다.

2. 서블릿 생명주기(Life Cycle) 관리

    - 서블릿 컨테이너는 서블릿의 탄생과 죽음을 관리한다.
    - 서블릿 클래스를 로딩하여 인스턴스화
    - 초기화 메소드를 호출
    - 요청이 들어오면 적절한 서블릿 메소드를 호출합니다.
    - 서블릿 소멸 시 Garbage Collection(가비지 컬렉션)을 진행

3. 멀티쓰레드 지원 및 관리

    - 서블릿 컨테이너는 요청이 올 때 마다 새로운 자바 쓰레드를 하나 생성
    - HTTP 서비스 메소드를 실행하고 나면, 쓰레드는 자동으로 소멸
    - 원래는 쓰레드를 관리해야 하지만 서버가 다중 쓰레드를 생성 및 운영해주니 쓰레드의 안정성에 대해서 걱정하지 않아도 된다.

4. 선언적인 보안 관리

    - 서블릿 컨테이너를 사용하면 개발자는 보안에 관련된 내용을 서블릿 또는 자바 클래스에 구현해 놓지 않아도 됩니다.
    - 일반적으로 보안관리는 XML 배포 서술자에 다가 기록하므로, 보안에 대해 수정할 일이 생겨도 자바 소스 코드를수정하여 다시 컴파일 하지 않아도 보안관리가 가능합니다.


사용자의 요청이 일어났을 때 하나의 라이프 사이클을 보면

1. 사용자가 서블릿에 대한 링크를 클릭한다.(HTTP 요청)
2. 컨테이너는 들어온 요청에 대해서 HttpServletRequest와 HttpServletResponse를 생성
3. 사용자가 보낸 URL를 분석해서 어떤 서블릿에 대한 요청인지 알아내고 스레드에 서블릿을 할당해서 실행하고 Request와 Response를 인자로 넘깁니다.
4. 컨테이너는 서블릿 Service()를 호출하고 Http메서드에 따라 doGet(), doPost()등을 호출
5. 그러면 서블릿은 요청 처리에 대한 응답을 생성해서 Response객체와 같은 곳에 실어서 응답을 보냅니다.
6. 응답이 이뤄지면 모든 작업이 끝난거고 컨테이너는 사용했던 request, response 객체를 소멸시키거나 쓰레드에 할당했던 서블릿을 해제하는 등의 일을 합니다.

![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FoXx2P%2FbtrkjXbwMwz%2FFlLyfDeValXnlRzO4iPwp0%2Fimg.png)


웹 서버가 필요한 이유
- 웹 서버에서는 정적 컨텐츠만 처리하도록 기능 분배를 해서 서버 부담을 줄이는 것
```
클라이언트가 이미지 파일(정적 컨텐츠)를 보낼 때..

웹 문서(html 문서)가 클라이언트로 보내질 때 
이미지 파일과 같은 정적 파일은 함께 보내지지 않음

먼저 html 문서를 받고, 이에 필요한 이미지 파일들을 
다시 서버로 요청해서 받아오는 것

따라서 웹 서버를 통해서 정적인 파일을 
애플리케이션 서버까지 가지 않고 앞단에 빠르게 보낼 수 있음!
```

WAS가 필요한 이유
- WAS를 통해 요청에 맞는 데이터를 DB에서 가져와 비즈니스 로직에 맞게 그때마다 결과를 만들고 제공하면서 자원을 효율적으로 사용할 수 있음
```
동적인 컨텐츠를 제공해야 할때..

웹 서버만으로는 사용자가 원하는 요청에 대한 결과값을 
모두 미리 만들어놓고 서비스하기에는 자원이 절대적으로 부족함

따라서 WAS를 통해 요청이 들어올 때마다 
DB와 비즈니스 로직을 통해 결과물을 만들어 제공!
```


참고 : 

https://gyoogle.dev/blog/web-knowledge/Web%20Server%EC%99%80%20WAS%EC%9D%98%20%EC%B0%A8%EC%9D%B4.html