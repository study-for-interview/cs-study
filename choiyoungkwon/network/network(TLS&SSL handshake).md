# TLS/SSL Hand Shake

## SSL(Secure Sokcet Layer) / TLS(Transport Layer Security)

- 컴퓨터 네트워크에서 통신보안을 제공하는 암호화 프로토콜입니다. (데이터 전송 시 평문이 아닌 암호화된 내용을 전송)
- 전송 계층과 응용 계층 사이에 독립적으로 위치

네스케이프에 의해서 SSL이 발명되었고, 이것이 점차 폭넓게 사용되다가 표준화 기구인 IETF의 관리로 변경되면서 TLS라는 이름으로 바뀌었다.
TLS 1.0은 SSL 3.0을 계승한다. 하지만 TLS라는 이름보다 SSL이라는 이름이 훨씬 많이 사용되고 있다.

## SSL(Secure Sockets Layer)
배경 : 1993년 웹서버와 브라우저간의 안전한 통신을 위해 Netscape사에 의해 개발됨

특징 : 세션 계층에서 적용되며, 응용 계층의 FTP, Telnet, Http 등의 프로토콜의 안전성 보장

지원 프로토콜 : HTTP(HTTPS:443), TELNET(TELNETS:992), POP3(POPS:995), FTP, NNTP, etc.

주요 기능 : 서버 인증, 클라이언트 인증, 기밀성 보장

## TLS(Transport Layer Security)
배경 : SSL 3.0이 표준화된 이후 IETF는 1996년 6월부터 TLS 프로토콜에 대한 표준화(SSL v3.1)

특징 : SSL 3.0을 기반으로 한 업그레이드 프로토콜

## SSL/TLS 주요기능
 - 신원확인
    - SSL 서버 인증서는 회사에 대한 방문조사 후 발급되기 때문에 고객들은 서버 인증서를 확인하여 회사의 웹 사이트가 실제로 존재하고, 회사의 소유임을 확인할 수 있다. 이것을 통해 고객은 안심하고 자신의 개인정보를 입력할 수 있다.
 - 메시지의 비밀보장
    - SSL로 회상의 웹 서버와 고객과 교환된 정보(신용카드 번호 등)를 하나의 Session 키로 암호화한다.
    - 이 Session 키를 안전하게 고객에게 전달하기 위해서는 회사의 공개키로 암호화하여 보낸다. 하나의 Session 키는 한번만 사용된다.
    - 그리고 각 Session에 한 고객에게 하나의 키가 사용된다. 따라서 권한이 없는 제3자는 전송되는 과정에서 정보를 가로채어 볼 수 없다.
 - 메시지의 무결성
    - 메시지가 전송될 때, 메시지의 내용에 따라 수신자와 발신자의 컴퓨터에서 암호 방식을 생성한다.
    - 한 글자라도 전송 중에 수정되어지면 수신받은 컴퓨터에서 다른 암호방식을 생성하여 수신자에게 경고 메시지가 보내집니다.
    - 메시지의 무결성으로 두 당사자가 서로에게 보내주는 메시지가 그대로 전달되었음을 알 수 있다.


# TLS/SSL HandShake
![image](https://hanjungv.github.io/post_img/201711/07/4.png)

1. client Hello: client에서 SSL버전 정보와 지원하는 암호화 방식, 무작위 바이트 문자열(이후에 사용하게 되는 중요한 데이터입니다)이 포함 되어 전달 됩니다. 이미 SSL handshake를 했었다면 세션을 재사용 할 수 있습니다.

2. server Hello: 지원하는 암호화 방식 중 서버에서 어떤것을 사용할 지, 세션 ID, 서버측에서 생성한 무작위 바이트 문자열을 전송합니다. 클라이언트에서 인증서를 요구하게 되면 SSL 인증서를 전송하게 됩니다.

3. 클라이언트는 인증서를 CA의 공개키로 복호화 한 후에 신뢰할 수 있는 사이트 인지 판단하게 됩니다.이 과정을 통해 클라이언트는 서버의 공개키를 얻게 됩니다.

- 인증서가 서버가 신뢰할 수 있는지 어떻게 판단할까?

    - 서버는 CA의 비밀키로 암호화 된 SSL 인증서를 제공한다. 이 인증서에는 서버측의 공개키와 서비스의 정보를 담고있다.
    - 브라우저는 이 인증서를 발급한 CA가 자신의 CA리스트에 있는지 확인한다.
    - 있다면 CA의 해당 공개키를 이용해서 인증서를 복호화한다. 
    - 복호화가 된다면 이 인증서는 CA의 비공개키에 의해 암호화 되었다는 것을 알 수 있다.

4. 이후 클라이언트는 자신이 만든 무작위 바이트 문자열과 서버쪽에서 전송된 무작위 바이트 문자열을 조합하여 pre master secret키를 생성합니다. 이 키는 이후 데이터를 주고 받을 때 대칭키 방식을 사용할 때 사용하게 됩니다. 이 pre master secret키를 서버로 전송할 때 인증서에서 받았던 키를 이용하여 공개키 방식 암호화를 하게 됩니다. 그리고 서버쪽으로 전송하게 됩니다.

5. 서버쪽에서는 수신한 pre master secret키를 비밀키를 이용하여 복호화 하여 얻게된다.

6. server client 둘 다 일련의 과정을 거쳐 pre master secret키를 master key로 만들게 되고 이 master key를 이용하여 session key를 만들게 된다. 이후 데이터를 주고 받을 떄 session key를 대칭키 방식으로 이용하여 통신하게 됩니다.

7. 통신이 끝나면 세션키를 폐기합니다.

참고 : 

https://aws-hyoh.tistory.com/entry/HTTPS-%ED%86%B5%EC%8B%A0%EA%B3%BC%EC%A0%95-%EC%89%BD%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-3SSL-Handshake

https://hanjungv.github.io/2017-11-07-1_CS_SSL/

https://www.ibm.com/docs/en/ibm-mq/7.5?topic=ssl-overview-tls-handshake

